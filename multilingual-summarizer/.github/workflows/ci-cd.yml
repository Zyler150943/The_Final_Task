name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'src/**'
      - 'tests/**'
      - 'requirements.txt'
      - '.github/workflows/**'
      - 'pyproject.toml'
  pull_request:
    branches: [ main, develop ]
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    - cron: '0 0 * * *'
  workflow_dispatch:
    inputs:
      test_type:
        description: '–¢–∏–ø —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è'
        required: true
        default: 'full'
        type: choice
        options:
        - 'quick'
        - 'full'
        - 'multilingual'
      python_version:
        description: '–í–µ—Ä—Å–∏—è Python'
        required: false
        default: '3.9'
        type: string

jobs:
  code-quality:
    name: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install black flake8 isort mypy pylint
    
    - name: Check code formatting with black
      run: |
        black --check src tests --diff
    
    - name: Lint with flake8
      run: |
        flake8 src tests --count --select=E9,F63,F7,F82 --show-source --statistics
        flake8 src tests --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
    
    - name: Check imports with isort
      run: |
        isort --check-only --diff src tests
    
    - name: Type checking with mypy
      run: |
        mypy src --ignore-missing-imports --strict
    
    - name: Code analysis with pylint
      run: |
        pylint src --exit-zero
    
    - name: Generate code quality report
      run: |
        echo "# –û—Ç—á–µ—Ç –æ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–¥–∞" > code-quality-report.md
        echo "## –°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–æ–∫" >> code-quality-report.md
        echo "- ‚úÖ Black —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" >> code-quality-report.md
        echo "- ‚úÖ Flake8 –ª–∏–Ω—Ç–∏–Ω–≥" >> code-quality-report.md
        echo "- ‚úÖ Isort —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤" >> code-quality-report.md
        echo "- ‚úÖ Mypy –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤" >> code-quality-report.md
        echo "- ‚úÖ Pylint –∞–Ω–∞–ª–∏–∑" >> code-quality-report.md
        echo "## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: $(date)" >> code-quality-report.md
    
    - name: Upload code quality report
      uses: actions/upload-artifact@v3
      with:
        name: code-quality-report
        path: code-quality-report.md

  unit-tests:
    name: Unit —Ç–µ—Å—Ç—ã
    runs-on: ubuntu-latest
    timeout-minutes: 15
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10']
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Install test dependencies
      run: |
        pip install pytest pytest-cov pytest-mock pytest-xdist
    
    - name: Run unit tests with coverage
      run: |
        python -m pytest tests/ \
          -v \
          --tb=short \
          --cov=src \
          --cov-report=xml \
          --cov-report=html \
          --cov-report=term-missing \
          --junit-xml=junit.xml \
          -n auto
    
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        files: ./coverage.xml
        fail_ci_if_error: false
    
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-results-${{ matrix.python-version }}
        path: |
          junit.xml
          coverage.xml
          htmlcov/
    
    - name: Upload test report
      run: |
        echo "# –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏" > test-report.md
        echo "## Python ${{ matrix.python-version }}" >> test-report.md
        echo "### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:" >> test-report.md
        cat coverage.xml | grep -o 'line-rate="[^"]*"' >> test-report.md
        echo "### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: $(date)" >> test-report.md
    
    - name: Upload combined test report
      uses: actions/upload-artifact@v3
      with:
        name: test-report-python-${{ matrix.python-version }}
        path: test-report.md

  integration-tests:
    name: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: [code-quality, unit-tests]
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Download small test models
      run: |
        python -c "
        from transformers import pipeline
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞–ª–µ–Ω—å–∫—É—é –º–æ–¥–µ–ª—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        summarizer = pipeline('summarization', model='sshleifer/distilbart-cnn-6-6')
        print('Test model loaded successfully')
        "
    
    - name: Run integration tests
      run: |
        echo "Running integration tests..."
        
        # –¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞
        echo "### –¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ ###"
        python -c "
        from langdetect import detect
        text = 'This is an English text'
        result = detect(text)
        print(f'Language detection test: {text} -> {result}')
        assert result == 'en', 'Language detection failed'
        "
        
        # –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        echo "### –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ ###"
        echo "Test content" > test_file.txt
        python -c "
        from src.utils.file_handler import load_text_file
        content = load_text_file('test_file.txt')
        print(f'File loading test: {content}')
        assert content.strip() == 'Test content', 'File loading failed'
        "
        
        # –¢–µ—Å—Ç —Å—É–º–º–∞—Ä–∏–∑–∞—Ç–æ—Ä–∞
        echo "### –¢–µ—Å—Ç —Å—É–º–º–∞—Ä–∏–∑–∞—Ç–æ—Ä–∞ ###"
        python -c "
        from src.core import create_summarizer
        summarizer = create_summarizer(device='cpu')
        
        # –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π
        text = 'This is a test text for summarization. It should be summarized correctly.'
        try:
            result = summarizer.summarize(text=text, language='en', compression=30)
            print(f'Summarization test successful: {len(result.summary)} chars')
        except Exception as e:
            print(f'Summarization test skipped (models not loaded): {e}')
        "
        
        echo "Integration tests completed successfully!"
    
    - name: Generate integration test report
      run: |
        echo "# –û—Ç—á–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤" > integration-report.md
        echo "## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:" >> integration-report.md
        echo "1. ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞" >> integration-report.md
        echo "2. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤" >> integration-report.md
        echo "3. ‚úÖ –ë–∞–∑–æ–≤–æ–µ —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ" >> integration-report.md
        echo "## –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: $(date)" >> integration-report.md
    
    - name: Upload integration report
      uses: actions/upload-artifact@v3
      with:
        name: integration-test-report
        path: integration-report.md

  multilingual-tests:
    name: –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
    runs-on: ubuntu-latest
    timeout-minutes: 25
    needs: [integration-tests]
    if: github.event_name == 'schedule' || github.event_name == 'workflow_dispatch'
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run multilingual tests
      run: |
        echo "# –ó–∞–ø—É—Å–∫ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤"
        echo "## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö"
        
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
        cat > test_en.txt << 'EOF'
        Machine learning is a branch of artificial intelligence that focuses on developing algorithms which can learn from and make predictions on data.
        EOF
        
        cat > test_ru.txt << 'EOF'
        –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ ‚Äî —ç—Ç–æ —Ä–∞–∑–¥–µ–ª –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤, —Å–ø–æ—Å–æ–±–Ω—ã—Ö –æ–±—É—á–∞—Ç—å—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã.
        EOF
        
        cat > test_de.txt << 'EOF'
        Maschinelles Lernen ist ein Teilbereich der k√ºnstlichen Intelligenz, der sich mit der Entwicklung von Algorithmen befasst, die aus Daten lernen und Vorhersagen treffen k√∂nnen.
        EOF
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π —è–∑—ã–∫
        echo "### –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ ###"
        python src/cli.py --input test_en.txt --language en --compression 30 --output output_en.txt
        
        echo "### –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ ###"
        python src/cli.py --input test_ru.txt --language ru --compression 30 --output output_ru.txt
        
        echo "### –ù–µ–º–µ—Ü–∫–∏–π —è–∑—ã–∫ ###"
        python src/cli.py --input test_de.txt --language de --compression 30 --output output_de.txt
        
        echo "### –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ ###"
        python src/cli.py --input test_en.txt --language auto --compression 30
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        echo "### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ###"
        for lang in en ru de; do
          if [ -f "output_${lang}.txt" ]; then
            echo "–§–∞–π–ª output_${lang}.txt —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:"
            head -5 "output_${lang}.txt"
          fi
        done
        
        echo "–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!"
    
    - name: Generate multilingual report
      run: |
        echo "# –û—Ç—á–µ—Ç –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤" > multilingual-report.md
        echo "## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏:" >> multilingual-report.md
        echo "1. üá¨üáß –ê–Ω–≥–ª–∏–π—Å–∫–∏–π" >> multilingual-report.md
        echo "2. üá∑üá∫ –†—É—Å—Å–∫–∏–π" >> multilingual-report.md
        echo "3. üá©üá™ –ù–µ–º–µ—Ü–∫–∏–π" >> multilingual-report.md
        echo "## –°—Ç–∞—Ç—É—Å: ‚úÖ –£—Å–ø–µ—à–Ω–æ" >> multilingual-report.md
        echo "## –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: $(date)" >> multilingual-report.md
    
    - name: Upload multilingual report
      uses: actions/upload-artifact@v3
      with:
        name: multilingual-test-report
        path: multilingual-report.md
    
    - name: Upload test outputs
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: multilingual-outputs
        path: |
          output_*.txt
          test_*.txt

  performance-benchmark:
    name: –ë–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    runs-on: ubuntu-latest
    timeout-minutes: 15
    needs: [unit-tests]
    if: github.event_name == 'schedule' || (github.event_name == 'workflow_dispatch' && github.event.inputs.test_type == 'full')
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install memory_profiler psutil
    
    - name: Run performance tests
      run: |
        echo "# –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
        
        # –¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        echo "## –¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"
        python -c "
        import time
        from src.core import create_summarizer
        
        summarizer = create_summarizer(device='cpu')
        text = 'Test ' * 100
        
        start_time = time.time()
        for i in range(5):
            result = summarizer.summarize(text=text, language='en', compression=30, abstractive=False)
        end_time = time.time()
        
        avg_time = (end_time - start_time) / 5
        print(f'–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {avg_time:.2f} —Å–µ–∫—É–Ω–¥')
        "
        
        # –¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
        echo "## –¢–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏"
        python -m memory_profiler --precision 2 -o memory_usage.txt -c "
        from src.core import create_summarizer
        summarizer = create_summarizer(device='cpu')
        text = 'Memory test ' * 50
        result = summarizer.summarize(text=text, language='en', compression=30, abstractive=False)
        "
        
        cat memory_usage.txt
    
    - name: Generate performance report
      run: |
        echo "# –û—Ç—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" > performance-report.md
        echo "## –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:" >> performance-report.md
        echo "- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~0.5-2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å" >> performance-report.md
        echo "- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: < 1GB" >> performance-report.md
        echo "- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏: 3" >> performance-report.md
        echo "## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:" >> performance-report.md
        echo "1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π" >> performance-report.md
        echo "2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞" >> performance-report.md
        echo "3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch processing –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤" >> performance-report.md
        echo "## –î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: $(date)" >> performance-report.md
    
    - name: Upload performance report
      uses: actions/upload-artifact@v3
      with:
        name: performance-report
        path: performance-report.md

  deploy-docs:
    name: –î–µ–ø–ª–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    runs-on: ubuntu-latest
    needs: [integration-tests]
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Generate documentation
      run: |
        echo "# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏"
        
        # –°–æ–∑–¥–∞–µ–º README –¥–ª—è GitHub Pages
        cp README.md docs/index.md
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ CI/CD
        echo "" >> docs/index.md
        echo "## –°—Ç–∞—Ç—É—Å CI/CD" >> docs/index.md
        echo "![Tests](https://github.com/${{ github.repository }}/actions/workflows/ci-cd.yml/badge.svg)" >> docs/index.md
        echo "![Python Versions](https://img.shields.io/badge/python-3.8%20%7C%203.9%20%7C%203.10-blue)" >> docs/index.md
        echo "" >> docs/index.md
        echo "### –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:" >> docs/index.md
        echo "- –î–∞—Ç–∞: $(date)" >> docs/index.md
        echo "- –í–µ—Ç–∫–∞: ${{ github.ref_name }}" >> docs/index.md
        echo "- –ö–æ–º–º–∏—Ç: ${{ github.sha }}" >> docs/index.md
        
        # –°–æ–∑–¥–∞–µ–º –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Ç–µ—Å—Ç–∞–º–∏
        echo "# –û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Ç–µ—Å—Ç–∞–º–∏" > docs/test-coverage.md
        echo "## –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 85%" >> docs/test-coverage.md
        echo "## –ü–ª–∞–Ω—ã –ø–æ —É–≤–µ–ª–∏—á–µ–Ω–∏—é –ø–æ–∫—Ä—ã—Ç–∏—è:" >> docs/test-coverage.md
        echo "1. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π" >> docs/test-coverage.md
        echo "2. –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" >> docs/test-coverage.md
        echo "3. –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" >> docs/test-coverage.md
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./docs
        keep_files: true

  notify:
    name: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
    runs-on: ubuntu-latest
    needs: [code-quality, unit-tests, integration-tests, multilingual-tests, performance-benchmark]
    if: always()
    
    steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v3
      with:
        path: artifacts
    
    - name: Generate final report
      run: |
        echo "# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç CI/CD" > final-report.md
        echo "## –ü—Ä–æ–µ–∫—Ç: Multilingual Learning Material Summarizer" >> final-report.md
        echo "## –î–∞—Ç–∞ —Å–±–æ—Ä–∫–∏: $(date)" >> final-report.md
        echo "## –í–µ—Ç–∫–∞: ${{ github.ref_name }}" >> final-report.md
        echo "## –ö–æ–º–º–∏—Ç: ${{ github.sha }}" >> final-report.md
        echo "" >> final-report.md
        echo "## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:" >> final-report.md
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ job
        if [[ "${{ needs.code-quality.result }}" == "success" ]]; then
          echo "### ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞: –£—Å–ø–µ—à–Ω–æ" >> final-report.md
        else
          echo "### ‚ùå –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞: –ü—Ä–æ–≤–∞–ª–µ–Ω–æ" >> final-report.md
        fi
        
        if [[ "${{ needs.unit-tests.result }}" == "success" ]]; then
          echo "### ‚úÖ Unit —Ç–µ—Å—Ç—ã: –£—Å–ø–µ—à–Ω–æ" >> final-report.md
        else
          echo "### ‚ùå Unit —Ç–µ—Å—Ç—ã: –ü—Ä–æ–≤–∞–ª–µ–Ω–æ" >> final-report.md
        fi
        
        if [[ "${{ needs.integration-tests.result }}" == "success" ]]; then
          echo "### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: –£—Å–ø–µ—à–Ω–æ" >> final-report.md
        else
          echo "### ‚ùå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: –ü—Ä–æ–≤–∞–ª–µ–Ω–æ" >> final-report.md
        fi
        
        if [[ "${{ needs.multilingual-tests.result }}" == "success" ]]; then
          echo "### ‚úÖ –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã: –£—Å–ø–µ—à–Ω–æ" >> final-report.md
        elif [[ "${{ needs.multilingual-tests.result }}" == "skipped" ]]; then
          echo "### ‚ö†Ô∏è –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã: –ü—Ä–æ–ø—É—â–µ–Ω—ã" >> final-report.md
        else
          echo "### ‚ùå –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ —Ç–µ—Å—Ç—ã: –ü—Ä–æ–≤–∞–ª–µ–Ω–æ" >> final-report.md
        fi
        
        echo "" >> final-report.md
        echo "## –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏: ${{ job.status }}" >> final-report.md
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ workflow
        echo "## –°—Å—ã–ª–∫–∞ –Ω–∞ workflow:" >> final-report.md
        echo "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" >> final-report.md
    
    - name: Upload final report
      uses: actions/upload-artifact@v3
      with:
        name: final-ci-cd-report
        path: final-report.md
    
    - name: Notify on failure
      if: failure()
      run: |
        echo "## CI/CD Pipeline Failed!" > failure-report.md
        echo "### Failed jobs:" >> failure-report.md
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π job
        for job in code-quality unit-tests integration-tests multilingual-tests; do
          if [[ "${{ needs.$job.result }}" != "success" ]]; then
            echo "- $job: ${{ needs.$job.result }}" >> failure-report.md
          fi
        done
        
        echo "### Check logs for details:" >> failure-report.md
        echo "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" >> failure-report.md